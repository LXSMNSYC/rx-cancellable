var Cancellable=function(e){"use strict";class n{constructor(){this.events={cancel:[]}}get cancelled(){return!1}cancel(){return!1}addEventListener(e,n){if("function"!=typeof n)return;const{events:t}=this;this.cancelled||e in t&&t[e].push(n)}removeEventListener(e,n){if("function"!=typeof n)return;const{events:t}=this;if(!this.cancelled&&e in t){const c=t[e].indexOf(n);-1!==c&&t[e].splice(c,1)}}}const t=new class extends n{get cancelled(){return!0}cancel(){return!1}};const c=new class extends n{get cancelled(){return!1}cancel(){return!1}},s=(e,n)=>e.events[n].forEach(n=>n.apply(e));class i extends n{constructor(){super(),this.state=c}get cancelled(){return this.state.cancelled}cancel(){return!this.cancelled&&(this.state=t,s(this,"cancel"),!0)}}return e.BooleanCancellable=i,e.CANCELLED=t,e.Cancellable=n,e.CompositeCancellable=class extends n{constructor(){super(),this.buffer=[],this.state=c}get cancelled(){return this.state.cancelled}cancel(){if(!this.cancelled){const{buffer:e}=this;this.buffer=[];for(const n of e)n.cancel();return this.state=t,!0}return!1}add(e){if(e instanceof n&&e!==this){if(!this.cancelled)return this.buffer.push(e),!0;e.cancel()}return!1}remove(e){if(e instanceof n&&e!==this){const{buffer:n}=this,t=n.indexOf(e);if(-1!==t)return n.splice(t,1),s(this,"cancel"),!0}return!1}},e.LinkedCancellable=class extends n{constructor(){super();const e=new i;this.origin=e,this.linked=e}get cancelled(){return this.origin.cancelled}cancel(){if(!this.cancelled){const{linked:e}=this,{origin:n}=this;return n!==e&&(this.unlink(),e.cancel(),this.linked=n),n.cancel(),s(this,"cancel"),!0}return!1}link(e){if(e instanceof n&&e!==this)if(this.cancelled)e.cancel();else{if(!e.cancelled){this.unlink(),this.linked=e;const n=()=>this.cancel();return e.addEventListener("cancel",n),this.listener=n,!0}this.cancel()}return!1}unlink(){if(!this.cancelled){const{linked:e}=this,{origin:n}=this;if(n!==e){const{listener:t}=this;return e.removeEventListener("cancel",t),this.listener=null,this.linked=n,!0}}return!1}},e.UNCANCELLED=c,e}({});