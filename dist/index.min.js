var Cancellable=function(e){"use strict";class t{constructor(){this.events={cancel:[]}}get cancelled(){return!1}cancel(){return!1}addEventListener(e,t){if("function"!=typeof t)return;const{events:n}=this;this.cancelled||e in n&&n[e].push(t)}removeEventListener(e,t){if("function"!=typeof t)return;const{events:n}=this;if(!this.cancelled&&e in n){const c=n[e].indexOf(t);-1!==c&&n[e].splice(c,1)}}}const n=new class extends t{get cancelled(){return!0}cancel(){return!1}};const c=new class extends t{get cancelled(){return!1}cancel(){return!1}},s=(e,t)=>e.events[t].forEach(t=>t.apply(e)),l=new WeakMap;class i extends t{constructor(){super(),l.set(this,c)}get cancelled(){return l.get(this).cancelled}cancel(){return!this.cancelled&&(l.set(this,n),s(this,"cancel"),!0)}}const a=new WeakMap,r=new WeakMap;const h=new WeakMap,u=new WeakMap,o=new WeakMap;return e.BooleanCancellable=i,e.CANCELLED=n,e.Cancellable=t,e.CompositeCancellable=class extends t{constructor(){super(),a.set(this,[]),r.set(this,c)}get cancelled(){return r.get(this).cancelled}cancel(){if(!this.cancelled){const e=a.get(this);a.set(this,[]);for(const t of e)t.cancel();return r.set(this,n),!0}return!1}add(e){if(e instanceof t&&e!==this){if(!this.cancelled)return a.get(this).push(e),!0;e.cancel()}return!1}remove(e){if(e instanceof t&&e!==this){const t=a.get(this),n=t.indexOf(e);if(-1!==n)return t.splice(n,1),s(this,"cancel"),!0}return!1}},e.LinkedCancellable=class extends t{constructor(){super();const e=new i;h.set(this,e),u.set(this,e)}get cancelled(){return h.get(this).cancelled}cancel(){if(!this.cancelled){const e=u.get(this),t=h.get(this);return t!==e&&(this.unlink(),e.cancel(),u.set(this,t)),t.cancel(),s(this,"cancel"),!0}return!1}link(e){if(e instanceof t&&e!==this)if(this.cancelled)e.cancel();else{if(!e.cancelled){this.unlink(),u.set(this,e);const t=()=>this.cancel();return e.addEventListener("cancel",t),o.set(this,t),!0}this.cancel()}return!1}unlink(){if(!this.cancelled){const e=u.get(this),t=h.get(this);if(t!==e){const n=o.get(this);return e.removeEventListener("cancel",n),o.set(this,null),u.set(this,t),!0}}return!1}},e.UNCANCELLED=c,e}({});