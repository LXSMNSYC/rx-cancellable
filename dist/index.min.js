var Cancellable=function(){"use strict";const e=(e,t)=>e.events[t].forEach(t=>t.apply(e)),t={cancelled:!0},n={cancelled:!1},s={active:!0},i={active:!1},c=new WeakMap,r=new WeakMap,a=new WeakMap;let l;class h{constructor(){c.set(this,n),r.set(this,s),this.events={enable:[],disable:[],cancel:[]},this.children=[]}static create(){null==l&&(l=new h);const e=new h;return c.set(e,l),r.set(e,l),a.set(e,l),e}get cancelled(){return c.get(this).cancelled}get active(){return r.get(this).active}enable(){return!this.cancelled&&!this.active&&(r.set(this,a.get(this)),e(this,"enable"),!0)}disable(){return!(this.cancelled||!this.active)&&(r.set(this,i),e(this,"disable"),!0)}isParentTo(e){const t=a.get(e);return null!=t&&(t===this||t!==l&&this.isParentTo(t))}setParent(e){if(e!==this&&!this.isParentTo(e)&&e instanceof h){if(!e.cancelled)return a.set(this,e),e.children.push(this),!0;this.cancel()}return!1}removeParent(e){return e.remove(this)}add(e){return e.setParent(this)}remove(e){return!this.cancelled&&a.get(e)===this&&(this.children=this.children.filter(t=>t!==e),a.set(e,l),!0)}cancel(){return!this.cancelled&&(e(this,"cancel"),this.children.forEach(e=>e.cancel()),c.set(this,t),!0)}addEventListener(e,t){if("function"!=typeof t)return;const{events:n}=this;this.cancelled||e in n&&n[e].push(t)}removeEventListener(e,t){if("function"!=typeof t)return;const{events:n}=this;if(!this.cancelled&&e in n){const s=n[e].indexOf(t);-1!==s&&n[e].splice(s,1)}}}return h}();